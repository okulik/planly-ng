!function(){"use strict";var a=angular.module("planlyApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ng-token-auth","bgf.paginateAnything","angularModalService","ui.date","ui.router","rails"]);a.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/trips",{templateUrl:"views/trips.html",controller:"TripsCtrl"}).when("/trip_details/:id",{templateUrl:"views/trip_details.html",controller:"TripDetailsCtrl"}).when("/trip_new",{templateUrl:"views/trip_new.html",controller:"TripNewCtrl"}).when("/sign_in",{templateUrl:"views/user_sessions/new.html",controller:"UserSessionsCtrl"}).when("/register",{templateUrl:"views/user_registrations/new.html",controller:"UserRegistrationsCtrl"}).otherwise({redirectTo:"/"})}]),a.config(["railsSerializerProvider",function(a){a.underscore(angular.identity).camelize(angular.identity)}]),a.config(["$httpProvider",function(a){a.defaults.headers.common={Accept:"application/vnd.trips+json; version=1"}}]),a.run(["$rootScope","$location",function(a,b){a.$on("auth:login-success",function(c,d){a.user=d,b.path("/trips")}),a.$on("auth:logout-success",function(){a.user=null,b.path("/")})}])}(),function(){"use strict";angular.module("planlyApp").controller("MainCtrl",function(){})}(),function(){"use strict";angular.module("planlyApp").controller("TripsCtrl",["$scope","$rootScope","$location","$http","$compile","$timeout","$q","Trip","Utils","ModalService","Constants",function(a,b,c,d,e,f,g,h,i,j,k){h.query().then(function(b){a.trips=b},function(){c.path("/")}),a.utils=i,a.constants=k,a.editTrip=function(a){c.path("trip_details/"+a.tid)},a.createNewTrip=function(){c.path("trip_new")},a.deleteTrip=function(b,c){j.showModal({templateUrl:"views/modals/delete_trip.html",controller:"YesNoCtrl",title:"Delete",inputs:{title:"Delete",text:'Do you really want to delete trip "'+b.destination+", "+b.comment+'"?'}}).then(function(d){d.element.modal(),d.close.then(function(d){d&&h.get({tid:b.tid}).then(function(b){b["delete"]().then(function(){a.trips.splice(c,1)})})})})},a.getNextMonthTrips=function(){return g(function(a,b){h.getNextMonthTrips().then(function(b){a({trips:b})},function(a){b(a)})})},a.filterTrips=function(b){b&&b.length>0?(a.filtering=!0,h.filter({destination:b}).then(function(b){a.trips=b})):(a.filtering=!1,h.query().then(function(b){a.trips=b}))},a.resetFilter=function(){a.destination="",a.filtering=!1,h.query().then(function(b){a.trips=b})},a.printTemplate=function(a,c){c.then(function(c){d.get(a).success(function(a){var g=angular.extend(b.$new(),c),h=e($("<div>"+a+"</div>"))(g),i=function(){g.$$phase||d.pendingRequests.length?f(i):(l(h.html()),g.$destroy())};i()})})};var l=function(a){var b=$('<iframe style="display: none"></iframe>').appendTo("body")[0];b.contentWindow.printAndRemove=function(){b.contentWindow.print(),b.contentWindow.onafterprint=function(){$(b).remove()}};var c='<!doctype html><html><head><title>Planly, plan your trips!</title><link rel="stylesheet" href="styles/main.css"></head><body onload="printAndRemove();">'+a+"</body></html>",d=b.contentWindow.document.open("text/html","replace");d.write(c),d.close()}}])}(),function(){"use strict";angular.module("planlyApp").controller("UserSessionsCtrl",["$scope",function(a){a.$on("auth:login-error",function(b,c){a.error=c.errors[0]})}])}(),function(){"use strict";angular.module("planlyApp").controller("UserRegistrationsCtrl",["$scope","$location","$auth",function(a,b,c){a.$on("auth:registration-email-error",function(b,c){a.error=c.errors}),a.handleRegBtnClick=function(){c.submitRegistration(a.registrationForm).then(function(){c.submitLogin({email:a.registrationForm.email,password:a.registrationForm.password})})["catch"](function(){})}}])}(),function(){"use strict";angular.module("planlyApp").controller("YesNoCtrl",["$scope","close","title","text",function(a,b,c,d){a.close=function(a){b(a,500)},a.title=c,a.text=d}])}(),function(){"use strict";angular.module("planlyApp").controller("TripNewCtrl",["$scope","$rootScope","Trip","$location",function(a,b,c,d){a.createNewTrip=function(){a.newTripForm.user_id=b.user.id,new c(a.newTripForm).create(),d.path("/trips")}}])}(),function(){"use strict";angular.module("planlyApp").controller("TripDetailsCtrl",["$scope","$rootScope","Trip","$location","$routeParams",function(a,b,c,d,e){c.get({tid:e.id}).then(function(b){a.trip=b},function(){d.path("/trips")}),a.updateTrip=function(){a.trip.update().then(function(){d.path("/trips")})}}])}(),function(){"use strict";angular.module("planlyApp").factory("Constants",[function(){return{apiVersion:"1"}}])}(),function(){"use strict";angular.module("planlyApp").factory("Utils",[function(){var a={},b=864e5;return a.daysToTrip=function(a){var c=Math.ceil((Date.parse(a)-Date.now())/b);return 0>=c?"past":c},a.isDateInFuture=function(a){var c=Math.ceil((Date.parse(a)-Date.now())/b);return 0>=c?!1:!0},a.displayDays=function(a){return 0>=a?"":a},a}])}(),function(){"use strict";angular.module("planlyApp").factory("Trip",["$http","railsResourceFactory","Constants",function(a,b,c){var d=b({url:"/api/trips",name:"trip",httpConfig:{headers:{Accept:"application/vnd.trips+json; version="+c.apiVersion}},idAttribute:"tid"});return d.getNextMonthTrips=function(){return d.$get("/api/trips/next_month")},d.filter=function(a){return d.$get("/api/trips/filter",a)},d}])}();